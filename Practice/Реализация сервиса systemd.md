## –ü–µ—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è
### –ï—Å—Ç—å –∫–æ–¥, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ systemd –∏ –≤ –Ω–µ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å **scheduler.start()**  

* –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–∞ –≤—Ä—É—á–Ω—É—é –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (—Å–æ —Å—Ç—Ä–æ–∫–∏), –ø—Ä–æ—Ü–µ—Å—Å –±—É–¥–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Å–µ—Å—Å–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞.
* –ï—Å–ª–∏ –ø—Ä–µ—Ä–≤–∞—Ç—å —Å–µ—Å—Å–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª –∏–ª–∏ –Ω–∞–∂–º—ë—à—å Ctrl+C), —Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ—Ü–µ—Å—Å —Ç–æ–∂–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–µ—Å—Å–∏–∏ (SIGHUP).
* –ï—Å–ª–∏ –∂–µ —Ç—ã –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª, –Ω–µ –¥–µ–ª–∞—è Ctrl+C, –ø—Ä–æ—Ü–µ—Å—Å —Ç–æ–∂–µ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è ‚Äî –æ–ø—è—Ç—å –∂–µ –∏–∑-–∑–∞ SIGHUP.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–æ—Ü–µ—Å—Å **—Ä–∞–±–æ—Ç–∞–ª –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–µ—Å—Å–∏–∏**, –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑:

* `nohup` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `nohup python script.py &`) ‚Äî —á—Ç–æ–±—ã –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å SIGHUP, –∏–ª–∏
* –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∫ systemd-—Å–µ—Ä–≤–∏—Å, —Ç–æ–≥–¥–∞ systemd —Å–∞–º –±—É–¥–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∏ –æ–Ω –Ω–µ –∑–∞–≤–∏—Å–∏–º –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å–µ—Å—Å–∏–∏.

---

**–í—ã–≤–æ–¥:**
–ï—Å–ª–∏ –ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å ‚Äî –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞–¥–æ —á–µ—Ä–µ–∑ systemd –∏–ª–∏ —Å –ø–æ–º–æ—â—å—é `nohup`/screen/tmux.

### BackgroundScheduler 
–≠—Ç–æ —á–∞—Å—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ **APScheduler** (Advanced Python Scheduler), –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á.

#### –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –æ–ø–∏—Å–∞–Ω–∏–µ

* –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç APScheduler:
  [https://apscheduler.readthedocs.io/en/latest/](https://apscheduler.readthedocs.io/en/latest/)

* –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø—Ä–æ `BackgroundScheduler` –∏ –º–µ—Ç–æ–¥ `add_job`:
  [https://apscheduler.readthedocs.io/en/latest/modules/schedulers/background.html](https://apscheduler.readthedocs.io/en/latest/modules/schedulers/background.html)
  –∏
  [https://apscheduler.readthedocs.io/en/latest/modules/triggers/cron.html](https://apscheduler.readthedocs.io/en/latest/modules/triggers/cron.html)

---

**–ü—Ä–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `add_job(run_etl, 'cron', minute='*/5')`:**

* `run_etl` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å.
* `'cron'` ‚Äî —Ç–∏–ø —Ç—Ä–∏–≥–≥–µ—Ä–∞, —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ cron.
* `minute='*/5'` ‚Äî –æ–∑–Ω–∞—á–∞–µ—Ç ¬´–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç¬ª. –ê–Ω–∞–ª–æ–≥ –∑–∞–ø–∏—Å–∏ –≤ crontab `*/5 * * * *`.

–ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ `'cron'` ‚Äî `hour`, `day`, `month`, `day_of_week` –∏ —Ç.–ø.

---

–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ–º –∫–æ–¥ –ø–æ–¥ Windows –∏–∑ VSCode –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏ –∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–∏–≤–∞–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é —Å–µ—Å—Å–∏—é, –ø—Ä–æ—Ü–µ—Å—Å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è**.

–ü–æ—á–µ–º—É?

* –í —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏ VSCode –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –∫–∞–∫ –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å.
* –ö–æ–≥–¥–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç–ª–∞–¥–∫—É, VSCode –ø–æ—Å—ã–ª–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.
* –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, `scheduler.start()` (–∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏) —Ç–æ–∂–µ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç —Ä–∞–±–æ—Ç—É, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.

---

### –ö–∞–∫ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ø–æ—Å–æ–±–∞ –∑–∞–ø—É—Å–∫–∞ –∏ –Ω—é–∞–Ω—Å—ã

---

#### 1. –ó–∞–ø—É—Å–∫ –∏–∑ VSCode –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏ (Debug)

* VSCode –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –∫–∞–∫ –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å.
* –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Ç–ª–∞–¥–∫–∏ VSCode **–ø–æ—Å—ã–ª–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** –ø—Ä–æ—Ü–µ—Å—Å—É.
* –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –∏ –≤–º–µ—Å—Ç–µ —Å –Ω–∏–º –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `BackgroundScheduler`.
* –ù–∏–∫–∞–∫–∏—Ö "–∑–∞–≤–∏—Å—à–∏—Ö" –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Ç–ª–∞–¥–∫–∏ –Ω–µ –æ—Å—Ç–∞—ë—Ç—Å—è.

**–ò—Ç–æ–≥–æ:** –í—Å—ë —á–∏—Å—Ç–æ, –≤—Ä—É—á–Ω—É—é –Ω–∏—á–µ–≥–æ –Ω–µ —É–±–∏–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

---

#### 2. –ó–∞–ø—É—Å–∫ –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –≤—Ä—É—á–Ω—É—é

* –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Å–µ—Å—Å–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞.
* –ï—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª, –ø—Ä–æ—Ü–µ—Å—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª SIGHUP –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
* –ù–æ –µ—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –≤ —Ñ–æ–Ω–µ —Å `nohup`, `&`, `screen` –∏–ª–∏ `tmux`, –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É –≤–Ω–µ —Å–µ—Å—Å–∏–∏.
* –¢–æ–≥–¥–∞ –ø—Ä–∏–¥–µ—Ç—Å—è –ª–∏–±–æ –≤—Ä—É—á–Ω—É—é –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å, –ª–∏–±–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã—Ö–æ–¥ –≤ –∫–æ–¥–µ.

---

#### 3. –ó–∞–ø—É—Å–∫ –∫–∞–∫ systemd-—Å–µ—Ä–≤–∏—Å (Linux)

* systemd —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º.
* –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å–µ—Å—Å–∏–∏ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç "–≤–µ—á–Ω–æ" –ø–æ–∫–∞ –Ω–µ —Å–∫–∞–∂—É—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.
* –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–∏—Å–∞ –∏–ª–∏ —Å–∏—Å—Ç–µ–º—ã systemd –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–æ–≤–æ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ).
* –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `systemctl stop`.

---

#### –ö–∞—Å–∞—Ç–µ–ª—å–Ω–æ `BackgroundScheduler`

* –û–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á–∏ –≤ —Ñ–æ–Ω–µ –≤ —Ä–∞–º–∫–∞—Ö **—Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞**.
* –ï—Å–ª–∏ —Å–∞–º –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è ‚Äî –∑–∞–¥–∞—á–∏ —Ç–æ–∂–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è.
* –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã scheduler —Ä–∞–±–æ—Ç–∞–ª ¬´–∫–∞–∫ —Å–µ—Ä–≤–∏—Å¬ª, –ª—É—á—à–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∫–∞–∫ —Å–ª—É–∂–±—É (systemd, Windows Service) –∏–ª–∏ —Å –ø–æ–º–æ—â—å—é –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, PM2, Supervisor, NSSM –Ω–∞ Windows).

---

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç `logging.basicConfig` –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `filename`

* –í –∫–æ–¥–µ:

  ```python
  logging.basicConfig(
      filename="/var/log/etl_service.log",
    ...  )
  ```

* `filename="/var/log/etl_service.log"` ‚Äî –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è INFO –∏ –≤—ã—à–µ (INFO, WARNING, ERROR, CRITICAL) –±—É–¥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –≤ —Ñ–∞–π–ª `/var/log/etl_service.log`.

* –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å **–ª—é–±–æ–π –ø—É—Ç—å –∏ –∏–º—è —Ñ–∞–π–ª–∞**, –∫—É–¥–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å. –ù–∞–ø—Ä–∏–º–µ—Ä:

  ```python
  filename="etl.log"
  ```

  —Ç–æ–≥–¥–∞ –ª–æ–≥ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –≤ –ø–∞–ø–∫–µ, –æ—Ç–∫—É–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç.

* –ï—Å–ª–∏ –ø—É—Ç—å —É–∫–∞–∑–∞—Ç—å **–∞–±—Å–æ–ª—é—Ç–Ω—ã–π** (`/var/log/etl_service.log`), –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç, –±—ã–ª–∏ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —ç—Ç—É –ø–∞–ø–∫—É.

---

**–ö—Ä–∞—Ç–∫–æ:**

* –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ª—é–±–æ–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É.
* –õ–æ–≥–∏ –ø–æ–π–¥—É—Ç –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª.
* –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, –æ–Ω –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∞).
* –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ ‚Äî –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∏–ª–∏ –ª–æ–≥ –º–æ–∂–µ—Ç –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è.

---

### –ü–æ–¥ –∫–∞–∫–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ VSCode —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª –ª–æ–≥–∞?

* VSCode –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –æ—Ç –∏–º–µ–Ω–∏ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º —Ç—ã –∑–∞–ª–æ–≥–∏–Ω–µ–Ω –≤ Windows (–∏–ª–∏ –≤ Linux).
* –ï—Å–ª–∏ —Ç—ã –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–∞–ª *Run* –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏–ª –æ—Ç–ª–∞–¥–∫—É, —Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å —Ç–≤–æ–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏.
* –ó–Ω–∞—á–∏—Ç, –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ç–æ–≥–æ, –µ—Å—Ç—å –ª–∏ —É —Ç–≤–æ–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ—Å—Ç—É–ø –∫ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ, –æ—Ç–∫—É–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç.

---

### –ü–æ—á–µ–º—É —Ñ–∞–π–ª –ª–æ–≥–∞ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è?

1. **–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É:**

   * –ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å `filename="etl_service.log"`, –ª–æ–≥ —Å–æ–∑–¥–∞—Å—Ç—Å—è –≤ **—Ç–µ–∫—É—â–µ–º —Ä–∞–±–æ—á–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ –ø—Ä–æ—Ü–µ—Å—Å–∞**.
   * –≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –ø–∞–ø–∫–∏, –≥–¥–µ –ª–µ–∂–∏—Ç —Å–∫—Ä–∏–ø—Ç!
   * –í VSCode –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è ‚Äî —ç—Ç–æ –æ–±—ã—á–Ω–æ **–∫–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞**, –∏–ª–∏ —Ç–∞, —á—Ç–æ —É–∫–∞–∑–∞–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∑–∞–ø—É—Å–∫–∞ (`launch.json`) –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `cwd`.

2. **–ü—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å:**
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏:**

---

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –æ—Ç–ª–∞–¥–∏—Ç—å?

1. **–í—ã–≤–µ—Å—Ç–∏ —Ç–µ–∫—É—â–∏–π —Ä–∞–±–æ—á–∏–π –∫–∞—Ç–∞–ª–æ–≥ –≤ —Å–∫—Ä–∏–ø—Ç–µ:**

   ```python
   import os
   print("Current working directory:", os.getcwd())
   ```

2. **–Ø–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –¥–ª—è –ª–æ–≥–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:**

   ```python
   filename="C:\\Users\\–¢–≤–æ–π–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\\etl_service.log"
   ```

   –∏–ª–∏ –Ω–∞ Linux:

   ```python
   filename="/tmp/etl_service.log"
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏ –∑–∞–ø–∏—Å–∏:**

   * –õ–æ–≥–≥–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è.
   * –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –∏–ª–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª –≤—Ä—É—á–Ω—É—é:

   ```python
   try:
       with open("etl_service.log", "a") as f:
           f.write("test log\n")
   except Exception as e:
       print("–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞:", e)
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ—Ç –ª–∏ –¥—Ä—É–≥–∏—Ö –≤—ã–∑–æ–≤–æ–≤ `logging.basicConfig` –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–µ—à–∞—é—Ç.**

---

### –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ VSCode?

1. –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `.vscode/launch.json` –≤ –ø—Ä–æ–µ–∫—Ç–µ. –ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—Ç—å.

2. –ù–∞–π—Ç–∏ (–∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å) –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∑–∞–ø—É—Å–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Python: –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞",
      "type": "python",
      "request": "launch",
      "program": "${file}",
      "console": "integratedTerminal",
      "cwd": "${fileDirname}"
    }
  ]
}
```

3. –í–∞–∂–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä ‚Äî `"cwd"` ‚Äî –∑–∞–¥–∞—ë—Ç —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é.

* `${fileDirname}` ‚Äî –ø–∞–ø–∫–∞, –≥–¥–µ –ª–µ–∂–∏—Ç –∑–∞–ø—É—Å–∫–∞–µ–º—ã–π —Ñ–∞–π–ª (—Å–∫—Ä–∏–ø—Ç).
* `${workspaceFolder}` ‚Äî –∫–æ—Ä–µ–Ω—å –æ—Ç–∫—Ä—ã—Ç–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞.

---

### –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—à—å –±–µ–∑ `launch.json` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä—è–º–æ –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ VSCode)

–¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç —Ç–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–∫—Ä—ã—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª. –ú–æ–∂–Ω–æ –µ—ë –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π:

* `pwd` (Linux/macOS)
* `cd` –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (Windows)

---

### –ö–∞–∫ –Ω–∞–π—Ç–∏ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å launch.json?

1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ VSCode (—á–µ—Ä–µ–∑ **File > Open Folder**), —Ç–æ–≥–¥–∞ –±—É–¥–µ—Ç –∫–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞.

2. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ —Å–Ω–∏–∑—É –Ω–∞–π—Ç–∏ –∑–Ω–∞—á–æ–∫ **Run and Debug** (–∏–ª–∏ –Ω–∞–∂–∞—Ç—å Ctrl+Shift+D).

3. –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞–ø—É—Å–∫–∞ ‚Äî –±—É–¥–µ—Ç –∫–Ω–æ–ø–∫–∞ **create a launch.json file** (—Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞). 

4. –í—ã–±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω –¥–ª—è Python ‚Äî VSCode —Å–æ–∑–¥–∞—Å—Ç `.vscode/launch.json` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

---

### –¢—Ä–∏–≥–≥–µ—Ä `'cron'`
–í APScheduler —Ç—Ä–∏–≥–≥–µ—Ä `'cron'` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å —à–∞–≥–æ–º –≤ —Å–µ–∫—É–Ω–¥—ã ‚Äî –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –º–∏–Ω—É—Ç–∞–º–∏ –∏ –≤—ã—à–µ.

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å–∫–∞—Ç—å –∑–∞–¥–∞—á—É **–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥**, –Ω–∞–¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä `'interval'`, –Ω–∞–ø—Ä–∏–º–µ—Ä —Ç–∞–∫:

```python
scheduler.add_job(run_etl, 'interval', seconds=5)
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç `run_etl` –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥.

---

–ï—Å–ª–∏ –æ—á–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è, –º–æ–∂–Ω–æ —Å `'cron'` –∑–∞–¥–∞–≤–∞—Ç—å –ø–æ —Å–µ–∫—É–Ω–¥–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `second='*/5'`), –Ω–æ –Ω–µ –≤–æ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏—è—Ö APScheduler —ç—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ. –õ—É—á—à–µ `'interval'` –¥–ª—è —Ç–∞–∫–∏—Ö —á–∞—Å—Ç—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤.

---

### –ö–∞–∫ –∑–∞—Å—Ç–∞–≤–∏—Ç—å logging –ø–∏—Å–∞—Ç—å –≤ —Ñ–∞–π–ª –≤ UTF-8?

–í `logging.basicConfig` –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `encoding`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∫—É —Ñ–∞–π–ª–∞.

–ü—Ä–∏–º–µ—Ä:

```python
logging.basicConfig(
    ...,
    encoding="utf-8"
)
```

---

### –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ:

* –ü–∞—Ä–∞–º–µ—Ç—Ä `encoding` –ø–æ—è–≤–∏–ª—Å—è –≤ Python 3.9 –∏ –Ω–æ–≤–µ–µ (—Ç–æ—á–Ω–æ –≤ 3.9+).

---

### –ü–æ—á–µ–º—É `run_etl` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏ –Ω–µ –ø–∏—à–µ—Ç –ª–æ–≥–∏?

–í —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏, –∫–æ–≥–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –±—Ä–µ–π–∫–ø–æ–∏–Ω—Ç –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—à—å—Å—è –Ω–∞ —Å—Ç—Ä–æ–∫–µ, –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ "–∑–∞–º–æ—Ä–æ–∂–µ–Ω" ‚Äî –∏ –∑–∞–¥–∞—á–∏ –≤ —Ñ–æ–Ω–µ (–≤ –¥—Ä—É–≥–∏—Ö –ø–æ—Ç–æ–∫–∞—Ö) –Ω–µ —Å–º–æ–≥—É—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è. –û–Ω–∏ –∂–¥—É—Ç, –ø–æ–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É.

–¶–∏–∫–ª —Å `time.sleep()` ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥, —á—Ç–æ–±—ã –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–≤–µ—Ä—à–∞–ª—Å—è –∏ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å.

---

## ‚úÖ –ì–¥–µ –ª–µ–∂–∞—Ç unit-—Ñ–∞–π–ª—ã systemd?

```bash
/etc/systemd/system/etl.service
```

–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö unit-—Ñ–∞–π–ª–æ–≤** (`systemd` –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å –∏—Ö –∑–¥–µ—Å—å –ø—Ä–∏ `systemctl start` –∏ `enable`).

---

## ‚úÖ –ü—Ä–æ—Å—Ç–æ–π `etl.service` unit-—Ñ–∞–π–ª (–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω)

–í–æ—Ç –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä:

```ini
[Unit]
Description=Postgres to clickhouse integration service
After=network.target

[Service]
Type=simple
User=admin
WorkingDirectory=/home/admin/systemd/integration/
#ExecStart=/usr/bin/python3 simple_etl.py
ExecStart=/home/admin/systemd/integration/pgchintegration/bin/python simple_etl.py
EnvironmentFile=/home/admin/systemd/integration/.env
Restart=always
RestartSec=5
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

### –ß—Ç–æ –Ω—É–∂–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **`User=your_user`** ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
2. **`WorkingDirectory=`** ‚Äî –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ, –≥–¥–µ –ª–µ–∂–∏—Ç —Å–∫—Ä–∏–ø—Ç.
3. **`ExecStart=`** ‚Äî –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ Python –∏ —Å–∫—Ä–∏–ø—Ç—É.

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ:

```bash
which python3
```

–≤—ã–¥–∞—ë—Ç –ø—É—Ç—å, —Å–æ–≤–ø–∞–¥–∞—é—â–∏–π —Å `/usr/bin/python3`

---

## ‚úÖ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å?

### 1. –°–æ–∑–¥–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —é–Ω–∏—Ç:

```bash
sudo nano /etc/systemd/system/pgchintegration.service
```

### 2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å systemd, —á—Ç–æ–±—ã –æ–Ω —É–≤–∏–¥–µ–ª –Ω–æ–≤—ã–π —é–Ω–∏—Ç:

```bash
sudo systemctl daemon-reexec
# –∏–ª–∏ –º–µ–Ω–µ–µ –∂–µ—Å—Ç–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç
sudo systemctl daemon-reload
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å:

```bash
sudo systemctl start pgchintegration.service
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:

```bash
sudo systemctl status pgchintegration.service
```

–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç - —Å—Ç–∞—Ç—É—Å `active (running)` –∏ –ª–æ–≥–∏.

### 5. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞:

```bash
journalctl -u pgchintegration.service -f
```

(–º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ `-xe` –±–µ–∑ `-f` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞)

### 6. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:

```bash
sudo systemctl stop pgchintegration.service
```

### 7. –î–æ–±–∞–≤–∏—Ç—å –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É:

```bash
sudo systemctl enable pgchintegration.service
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

* –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –ø–∏—à–µ—Ç –ª–æ–≥ –≤ —Ñ–∞–π–ª ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—É—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `User=...`.
* systemd –±—É–¥–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å `stdout` –∏ `stderr` –≤ `journalctl`, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ `StandardOutput=journal`.

---

## üëâ –ó–∞–ø—É—Å–∫ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (venv)

## üîß –ì–¥–µ –¥–æ–ª–∂–Ω—ã –ª–µ–∂–∞—Ç—å systemd unit-—Ñ–∞–π–ª—ã?

### üìÅ `/etc/systemd/system/`

–≠—Ç–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —é–Ω–∏—Ç–æ–≤**, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≤—Ä—É—á–Ω—É—é:

* –Æ–Ω–∏—Ç—ã –∑–¥–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã **–≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ** (–≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º).
* –°–ª—É–∂–±—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è **–æ—Ç –∏–º–µ–Ω–∏ root** –∏–ª–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`User=...`).
* –≠—Ç–æ —Ç–æ –º–µ—Å—Ç–æ, –∫—É–¥–∞ systemd –æ–∂–∏–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–ª—É–∂–±—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `pgchintegration.service`).

> ‚úÖ –≠—Ç–æ **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –º–µ—Å—Ç–æ**, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —Å–ª—É–∂–±–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–ª–∏ –±—ã–ª–∞ —á–∞—Å—Ç—å—é —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–ª—É–∂–± (`systemctl start`, `enable`, `status` –∏ —Ç.–¥.)

---

### üìÅ `/etc/systemd/user/`

–≠—Ç–æ ‚Äî **–¥–ª—è user units**, —Ç.–µ. —Å–ª—É–∂–±, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è **–≤ —Ä–∞–º–∫–∞—Ö —Å–µ—Å—Å–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**, –∞ –Ω–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã.

* –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–µ —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π `systemctl`, –∞ —á–µ—Ä–µ–∑ `systemctl --user`.
* –†–∞–±–æ—Ç–∞—é—Ç **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (–µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∏–Ω–∞—á–µ).
* –ù–µ —Å—Ç–∞—Ä—Ç—É—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã, –µ—Å–ª–∏ –Ω–µ –≤–∫–ª—é—á—ë–Ω user lingering.

> ‚ö†Ô∏è –≠—Ç–æ **–Ω–µ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ**, –µ—Å–ª–∏ –Ω–µ–æ–±—ä–æ–¥–∏–º–æ, —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–ª –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã.

---

## üì¶ –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —é–Ω–∏—Ç—ã —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (PostgreSQL, ClickHouse –∏ —Ç.–ø.)?

### üìÅ `/usr/lib/systemd/system/`

* –°—é–¥–∞ —Å—Ç–∞–≤—è—Ç—Å—è **—é–Ω–∏—Ç—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç—ã** (`rpm`, `deb` –∏ —Ç.–¥.).
* –ù–∞–ø—Ä–∏–º–µ—Ä:

  * PostgreSQL: `/usr/lib/systemd/system/postgresql.service`
  * ClickHouse: `/usr/lib/systemd/system/clickhouse-server.service`

> üìå **–ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –∏—Ö –ø—Ä—è–º–æ –∑–¥–µ—Å—å**, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å ‚Äî –ª—É—á—à–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ `/etc/systemd/system/` –∏ —Ç–∞–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å.

---

## üí° –ò—Ç–æ–≥–æ: `pgchintegration.service` –¥–æ–ª–∂–µ–Ω –ª–µ–∂–∞—Ç—å?

**‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ:**

```bash
/etc/systemd/system/etl.service
```

* –î–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ.
* –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å.
* –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sudo systemctl start|stop|enable etl.service`.

---

### How to

1. üîç –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –≥–¥–µ –ª–µ–∂–∞—Ç systemd-—é–Ω–∏—Ç—ã.
2. üõ† –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π —é–Ω–∏—Ç (–±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è).
3. üìã –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —é–Ω–∏—Ç—ã.

---

## üîç 1. –ì–¥–µ –ª–µ–∂–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —é–Ω–∏—Ç?

–ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–π—Ç–∏ —é–Ω–∏—Ç `postgresql.service`:

```bash
systemctl status postgresql
```

–í —Å—Ç—Ä–æ–∫–µ `Loaded:` –±—É–¥–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–æ, –æ—Ç–∫—É–¥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω —é–Ω–∏—Ç:

```text
Loaded: loaded (/usr/lib/systemd/system/postgresql.service; enabled; vendor preset: disabled)
```

---

## üõ† 2. –ö–∞–∫ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π —é–Ω–∏—Ç (–±–µ–∑ –ø—Ä—è–º–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —é–Ω–∏—Ç PostgreSQL (–∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –∏–∑ `/usr/lib/systemd/system/`) ‚Äî –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –µ–≥–æ –ø—Ä—è–º–æ.

–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:

```bash
sudo systemctl edit postgresql
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç (–∏–ª–∏ –æ—Ç–∫—Ä–æ–µ—Ç) —Ñ–∞–π–ª-–æ–≤–µ—Ä–ª–µ–π:

```bash
/etc/systemd/system/postgresql.service.d/override.conf
```

–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è. –ù–∞–ø—Ä–∏–º–µ—Ä:

```ini
[Service]
Environment="PGDATA=/custom/postgres/data"
```

–ü–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:

```bash
sudo systemctl daemon-reload
sudo systemctl restart postgresql
```

---

## üìã 3. –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —é–Ω–∏—Ç—ã

### –í—Å–µ —é–Ω–∏—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ systemd –∑–Ω–∞–µ—Ç:

```bash
systemctl list-unit-files
```

### –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

```bash
systemctl list-units --type=service
```

### –ù–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —é–Ω–∏—Ç:

```bash
systemctl list-units | grep etl
systemctl list-unit-files | grep postgres
```

---

## üìç –ì–¥–µ systemd –∏—â–µ—Ç —é–Ω–∏—Ç—ã (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)

```bash
/etc/systemd/system/               # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —é–Ω–∏—Ç—ã
/run/systemd/system/              # –≤—Ä–µ–º–µ–Ω–Ω—ã–µ (–Ω–∞–ø—Ä. —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
/usr/lib/systemd/system/          # —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç–æ–º
```

–ò –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:

```bash
/etc/systemd/system/<service>.service.d/override.conf
```

---


## –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (venv)

---

### ‚úÖ –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–æ–ø—É—Å—Ç–∏–º, –ø—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –ø—É—Ç–∏:

```bash
/home/admin/systemd/integration
```

### –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

```bash
cd /home/admin/systemd/integration
python3 -m venv pgchintegration
```

### –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∏ —Å—Ç–∞–≤–∏–º –Ω—É–∂–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:

```bash
source pgchintegration/bin/activate
pip install apscheduler psycopg2-binary clickhouse-connect
# –∏ –≤—Å—ë, —á—Ç–æ –µ—â—ë –Ω—É–∂–Ω–æ
```

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —É–±–µ–¥–∏—Ç—å—Å—è:

```bash
(pgchintegration) $ which python
# ~/systemd/integration/pgchintegration/bin/python
```

---

### ‚úÖ –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å unit-—Ñ–∞–π–ª etl.service

```bash
sudo nano /etc/systemd/system/etl.service
```

–ò –∏–∑–º–µ–Ω—è–µ–º —Ç–∞–∫:

```ini
[Unit]
Description=Postgres to clickhouse integration service
After=network.target

[Service]
Type=simple
User=admin
WorkingDirectory=/home/admin/systemd/integration/
#ExecStart=/usr/bin/python3 simple_etl.py
ExecStart=/home/admin/systemd/integration/pgchintegration/bin/python simple_etl.py
EnvironmentFile=/home/admin/systemd/integration/.env
Restart=always
RestartSec=5
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

üîß –ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:
**`ExecStart`** —Ç–µ–ø–µ—Ä—å –∑–∞–ø—É—Å–∫–∞–µ—Ç Python –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

### ‚úÖ –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º

```bash
sudo systemctl daemon-reload
sudo systemctl restart pgchintegration.service
sudo systemctl status pgchintegration.service
```

---

### üëÅ –ö–∞–∫ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è venv?

1. **–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `simple_etl.py` –∑–∞–ø–∏—Å—å –ø—É—Ç–∏ Python:**

```python
import sys
import logging
logging.info(f"Python path: {sys.executable}")
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞, –≤ –ª–æ–≥–µ –±—É–¥–µ—Ç:

```
Python path: /systemd/integration/pgchintegration/bin/python
```

2. **–ò–ª–∏, –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å `print(sys.executable)` ‚Äî –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤ journalctl:**

```bash
journalctl -u pgchintegration.service -f
```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω—É–∂–Ω—ã–µ –ø–∞–∫–µ—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `apscheduler`) ‚Äî –µ—Å–ª–∏ –±—ã –æ–Ω –Ω–µ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ venv, —Å–µ—Ä–≤–∏—Å –±—ã —É–ø–∞–ª.**

---

## üßº –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `PYTHONPATH`, `ENV`, API-–∫–ª—é—á–∏ –∏ —Ç.–¥.), –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

```ini
Environment="ENV=production"
Environment="PYTHONUNBUFFERED=1"
```

–õ–∏–±–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å `.env` —Ñ–∞–π–ª –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ `EnvironmentFile=`.

---

## –û—à–∏–±–∫–∞ `Permission denied` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Python –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—á–µ–Ω—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–∞—è, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ systemd –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—É—Ç–µ–π.

---

### üîé –û—à–∏–±–∫–∞:

```
Failed to locate executable .../bin/python: Permission denied
```

–û–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ **systemd –Ω–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ–∞–π–ª**, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

---

### üß≠ –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

#### 1. ‚úÖ –ü—Ä–∞–≤–∞ –Ω–∞ —Å–∞–º —Ñ–∞–π–ª `/home/admin/systemd/integration/pgchintegration/bin/python`

–£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª:

* **—Å—É—â–µ—Å—Ç–≤—É–µ—Ç**
* **–∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π**
* **—á–∏—Ç–∞–µ–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å (`User=...`)

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:

```bash
ls -l /home/admin/systemd/integration/pgchintegration/bin/python
```

–û–∂–∏–¥–∞–µ–º:

```text
-rwxr-xr-x 1 admin admin ... python
```

–ï—Å–ª–∏ –Ω–µ—Ç `x` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å:

```bash
chmod +x /home/admin/systemd/integration/pgchintegration/bin/python
```

---

#### 2. ‚úÖ –ü—Ä–∞–≤–∞ –Ω–∞ –≤—Å–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

Systemd –Ω–µ –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –æ–¥–Ω–∞ –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –ø–∞–ø–æ–∫ **–Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ–º–∞—è (–±–µ–∑ `x`)**.

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:

```bash
ls -ld /home
ls -ld /home/admin
ls -ld /home/admin/systemd
ls -ld /home/admin/systemd/integration
```

–û–Ω–∏ **–≤—Å–µ** –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `drwxr-xr-x` –∏–ª–∏ —Ö–æ—Ç—è –±—ã `--x` –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ï—Å–ª–∏ `User=admin` –≤ —é–Ω–∏—Ç–µ ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ù–æ –µ—Å–ª–∏ —é–Ω–∏—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç `root`, –∏ –æ–¥–Ω–∞ –∏–∑ –ø–∞–ø–æ–∫ –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ–º–∞—è –¥–ª—è `root`, –±—É–¥–µ—Ç `Permission denied`.

---

#### 3. ‚úÖ –°–µ–ª–∏–Ω—É–∫—Å (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω)

–ï—Å–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ –≤–∫–ª—é—á—ë–Ω **SELinux**, –æ–Ω –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ ¬´–Ω–µ—Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö¬ª –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä: `/home/admin/...`

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:

```bash
getenforce
```

–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç `Enforcing` ‚Äî —ç—Ç–æ –ø–æ—á—Ç–∏ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ –ø—Ä–∏—á–∏–Ω–∞.

üîß –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è:

* –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å (–¥–ª—è —Ç–µ—Å—Ç–∞):

  ```bash
  sudo setenforce 0
  ```

* –ò–ª–∏ **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/opt/pgchintegration`), –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –¥–ª—è systemd.

---

#### 4. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `ExecStart` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–ü–æ–∫–∞ –æ—Ç–ª–∞–∂–∏–≤–∞–µ—à—å, –º–æ–∂–µ—à—å –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å `ExecStart` –Ω–∞ —Å–∫—Ä–∏–ø—Ç-–æ–±—ë—Ä—Ç–∫—É:

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `/home/admin/systemd/integration/start.sh`:

```bash
#!/bin/bash
echo "–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ $(which python)"
/home/admin/systemd/integration/pgchintegration/bin/python simple_etl.py
```

–°–¥–µ–ª–∞—Ç—å –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
chmod +x start.sh
```

–ò –≤ `etl.service`:

```ini
ExecStart=/home/admin/systemd/integration/start.sh
```

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –∏–º–µ–Ω–Ω–æ –≤ –¥–æ—Å—Ç—É–ø–µ –∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä—É.

---

### ‚úÖ –ü–æ–¥–≤–æ–¥–∏–º –∏—Ç–æ–≥

* `Permission denied` —á–∞—â–µ –≤—Å–µ–≥–æ:

* –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
* SELinux –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫.
* –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –¥–æ `python` –¥–æ—Å—Ç—É–ø–Ω—ã (`+x`).
* –î–ª—è SELinux ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∞ –∏–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—É—Ç—å (`/opt/...`).
* –°–∫—Ä–∏–ø—Ç-–æ–±—ë—Ä—Ç–∫–∞ (`start.sh`) ‚Äî —Ö–æ—Ä–æ—à–µ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ –æ—Ç–ª–∞–¥–∫–∏.

---


### –í—ã—è—Å–Ω–∏–ª–∏ –ø—Ä–∏—á–∏–Ω—É ‚Äî –¥–∞, **SELinux** –¥–æ–≤–æ–ª—å–Ω–æ —á–∞—Å—Ç–æ –º–µ—à–∞–µ—Ç –∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö.

---

## ‚ö†Ô∏è –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–∫–ª—é—á–µ–Ω–∏—è SELinux

**–í—Ä–µ–º–µ–Ω–Ω–æ** –∏–ª–∏ **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ** –æ—Ç–∫–ª—é—á–∏—Ç—å SELinux:

---

### üîß –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Ä–µ–º–µ–Ω–Ω–æ (–¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
sudo setenforce 0
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:

```bash
getenforce
# ‚Üí Permissive
```

> –í —Ä–µ–∂–∏–º–µ `Permissive` SELinux **–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç**, –∞ —Ç–æ–ª—å–∫–æ **–ª–æ–≥–∏—Ä—É–µ—Ç** –Ω–∞—Ä—É—à–µ–Ω–∏—è.

–ß—Ç–æ–±—ã —Å–Ω–æ–≤–∞ –≤–∫–ª—é—á–∏—Ç—å:

```bash
sudo setenforce 1
```

---

### üß® –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç—å SELinux (–Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–∫—É)

> ‚ö†Ô∏è –î–µ–ª–∞—Ç—å —ç—Ç–æ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–Ω–∏–º–∞–µ—à—å, —á—Ç–æ **—Ç–µ—Ä—è–µ—à—å —É—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã —Å–∏—Å—Ç–µ–º—ã**. –õ—É—á—à–µ ‚Äî –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω—É–∂–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ (—Å–º. –Ω–∏–∂–µ), –Ω–æ –µ—Å–ª–∏ –æ—Ç–∫–ª—é—á–∞—Ç—å, —Ç–æ —Ç–∞–∫:

#### –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Ñ–∏–≥

```bash
sudo nano /etc/selinux/config
```

#### –®–∞–≥ 2: –ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É:

```ini
SELINUX=enforcing
```

#### –®–∞–≥ 3: –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:

```ini
SELINUX=disabled
```

#### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∏—Å—Ç–µ–º—É:

```bash
sudo reboot
```

---

## ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å SELinux, –Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—É—Å–∫

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å **–Ω–µ –æ—Ç–∫–ª—é—á–∞—Ç—å SELinux**, –∞ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—É—Å–∫ Python –≤ –Ω—É–∂–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫:

```bash
sudo chcon -Rt bin_t /home/admin/systemd/integration/pgchintegration/bin
```

–ò–ª–∏ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:

```bash
sudo chcon -t bin_t /home/admin/systemd/integration/pgchintegration/bin/python
```

–ò–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ `/opt/`:

```bash
/opt/pgchintegration/
```

–ü–∞–ø–∫–∏ –≤ `/opt` –∏–ª–∏ `/usr/local` —É–∂–µ –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã SELinux.

---

## ‚úÖ –¶–µ–ª—å: –¥–∞—Ç—å systemd —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞—Ç—å Python –∏–∑ venv, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–≥–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `/home/admin/...`

–ù–∞—Å—Ç—Ä–æ–∏–º SELinux **–ø—Ä–∞–≤–∏–ª—å–Ω–æ**, —á—Ç–æ–±—ã —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–ª –±–µ–∑ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã. –≠—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è **–Ω–∞–∏–ª—É—á—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π** –Ω–∞ –ø—Ä–æ–¥–µ.

---

### üîé –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–∏–µ –æ—à–∏–±–∫–∏ SELinux

–í SELinux –≤—Å–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è. –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ausearch` –∏–ª–∏ `journalctl`.

–ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `setroubleshoot-server`, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```bash
sudo sealert -a /var/log/audit/audit.log
```

–õ–∏–±–æ —á–µ—Ä–µ–∑ `ausearch`:

```bash
sudo ausearch -m avc -ts recent
```

> –¢–∞–º –±—É–¥—É—Ç —Å—Ç—Ä–æ–∫–∏ –≤—Ä–æ–¥–µ:
> `type=AVC msg=audit(‚Ä¶): avc: denied { execute } for pid=‚Ä¶ comm="(python)" ...`

---

### üõ† –®–∞–≥ 2: –î–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `chcon`

–≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, **–¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏**.

```bash
sudo chcon -t bin_t /home/admin/systemd/integration/pgchintegration/bin/python
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –≤–Ω—É—Ç—Ä–∏:

```bash
sudo chcon -R -t bin_t /home/admin/systemd/integration/pgchintegration/bin/
```

---

### üíæ –®–∞–≥ 3: –°–¥–µ–ª–∞—Ç—å –º–µ—Ç–∫–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏ (—á–µ—Ä–µ–∑ `semanage`)

> –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Ç–∏–ª–∏—Ç—É `policycoreutils-python-utils`:

```bash
sudo dnf install policycoreutils-python-utils
```

–¢–µ–ø–µ—Ä—å –Ω–∞–∑–Ω–∞—á–∏–º **–ø–æ—Å—Ç–æ—è–Ω–Ω—É—é –º–µ—Ç–∫—É**:

```bash
sudo semanage fcontext -a -t bin_t "/home/admin/systemd/integration/pgchintegration/bin(/.*)?"
sudo restorecon -Rv /home/admin/systemd/integration/pgchintegration/bin/
```

---

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏–º:

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ systemd:

```bash
sudo systemctl daemon-reload
sudo systemctl restart pgchintegration.service
```

2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
sudo systemctl status pgchintegration.service
```

3. –ò —á—Ç–æ SELinux –Ω–µ –∂–∞–ª—É–µ—Ç—Å—è:

```bash
sudo ausearch -m avc -ts recent
```

---

## üß† –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ø–æ–ª–æ–∂–∏—Ç—å venv –≤ "–±–µ–ª—É—é –∑–æ–Ω—É"

–í–º–µ—Å—Ç–æ `/home/admin/...`, –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ `/opt`, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```bash
sudo mv /home/admin/systemd/integration/pgchintegration /opt/pgchintegration
```

–ò –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ —é–Ω–∏—Ç-—Ñ–∞–π–ª–µ:

```ini
ExecStart=/opt/pgchintegration/bin/python simple_etl.py
```

–£ `/opt` —É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã SELinux –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º.

---

## üìå –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é SELinux-–ø–æ–ª–∏—Ç–∏–∫—É**

–ß—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∏–º–µ–ª —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Python –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî **–±–µ–∑ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è SELinux –∏ –±–µ–∑ –≤–∑–ª–æ–º–∞ —Å–∏—Å—Ç–µ–º—ã –º–µ—Ç–∫–∞–º–∏.**

–°–æ–∑–¥–∞—ë–º —Å–≤–æ—é –ø–æ–ª–∏—Ç–∏–∫—É SELinux, –∫–æ—Ç–æ—Ä–∞—è:

* **—Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–µ—Ä–≤–∏—Å—É** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `pgchintegration.service`)
* **–≤—ã–ø–æ–ª–Ω—è—Ç—å Python** –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/home/admin/systemd/integration/...`)
* –∏ **–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ** ‚Äî –±–µ–∑ —Å–Ω—è—Ç–∏—è SELinux, `chcon`, `disable`, –∏ —Ç.–ø.

---

## üß∞ –ß—Ç–æ –Ω—É–∂–Ω–æ:

–£—Å—Ç–∞–Ω–æ–≤–∏–º –Ω—É–∂–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

```bash
sudo dnf install policycoreutils-devel checkpolicy selinux-policy-devel -y
```

(–Ω–∞ CentOS/Alma/RHEL ‚Äî —ç—Ç–æ –≤—Å—ë –µ—Å—Ç—å –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ä–µ–ø–∞—Ö)

---

## ‚úÖ –®–∞–≥ 1: –í–∫–ª—é—á–∏–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω–µ –≤–∫–ª—é—á–µ–Ω–æ)

–ó–∞–ø—É—Å—Ç–∏–º —Å–µ—Ä–≤–∏—Å, —á—Ç–æ–±—ã SELinux **–∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–ª –æ—Ç–∫–∞–∑**:

```bash
sudo systemctl restart pgchintegration.service
```

---

## ‚úÖ –®–∞–≥ 2: –ù–∞–π–¥–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ SELinux

```bash
sudo ausearch -m avc -ts recent
```

–ò–ª–∏:

```bash
sudo journalctl -t setroubleshoot
```

---

## ‚úÖ –®–∞–≥ 3: –°–æ–∑–¥–∞–¥–∏–º –∫–∞—Å—Ç–æ–º–Ω—É—é SELinux-–ø–æ–ª–∏—Ç–∏–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ï—Å—Ç—å —É—Ç–∏–ª–∏—Ç–∞ `audit2allow`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ –ª–æ–≥–∞–º **—Å–∞–º–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω—É–∂–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É**:

```bash
sudo ausearch -c 'pgchintegration' --raw | audit2allow -M pgchintegration_policy
```

> –ó–¥–µ—Å—å `'pgchintegration'` ‚Äî —ç—Ç–æ `comm=` –∏–∑ –∂—É—Ä–Ω–∞–ª–∞ SELinux (–æ–±—ã—á–Ω–æ –∏–º—è –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞).

---

## ‚úÖ –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∏–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É

```bash
sudo semodule -i pgchintegration_policy.pp
```

–¢–µ–ø–µ—Ä—å SELinux –±—É–¥–µ—Ç **—Ä–∞–∑—Ä–µ—à–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç—É –æ–ø–µ—Ä–∞—Ü–∏—é**, —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã/–ø—É—Ç–∏.

---

## üõ° –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã `audit2allow`

–í–æ—Ç –∫–∞–∫ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –∞–≤—Ç–æ—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞:

```bash
module pgchintegration_policy 1.0;

require {
    type unconfined_t;
    type admin_home_t;
    class file { execute open read };
}

# Allow access
allow unconfined_t admin_home_t:file { execute open read };
```

–ï—ë –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø–æ–¥–ø—Ä–∞–≤–∏—Ç—å –∏ —Å–æ–±—Ä–∞—Ç—å:

```bash
checkmodule -M -m -o pgchintegration_policy.mod pgchintegration_policy.te
semodule_package -o pgchintegration_policy.pp -m pgchintegration_policy.mod
semodule -i pgchintegration_policy.pp
```

---

## üìã –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å:

```bash
sudo systemctl restart pgchintegration.service
```

2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—à–∏–±–æ–∫ SELinux –±–æ–ª—å—à–µ –Ω–µ—Ç:

```bash
sudo ausearch -m avc -ts recent
```

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫:

```bash
semodule -l | grep pgchintegration
```

---

## ‚ùóÔ∏è–í–∞–∂–Ω–æ

* –¢–∞–∫–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–µ–π—Å—Ç–≤—É—é—Ç **—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** ‚Äî SELinux –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –∑–∞—â–∏—â–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É.
* –ü–æ–ª–∏—Ç–∏–∫–∞ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ —Ç–∏–ø—É (`type`) –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Äî –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ–ª–µ–µ —É–∑–∫—É—é –ø–æ–ª–∏—Ç–∏–∫—É –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.
* –≠—Ç–æ **—á–∏—Å—Ç—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π** –ø—É—Ç—å ‚Äî –∫–∞–∫ –¥–µ–ª–∞—é—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –≤ –±–∞–Ω–∫–∞—Ö, —Ç–µ–ª–µ–∫–æ–º–∞—Ö –∏ –≥–æ—Å—Å–µ–∫—Ç–æ—Ä–∞—Ö.

---

## üéØ –°–æ–∑–¥–∞–¥–∏–º —Ä—É—á–Ω—É—é SELinux-–ø–æ–ª–∏—Ç–∏–∫—É (.te) ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —á–∏—Å—Ç–æ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ

–≠—Ç–æ –¥–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ, **–∫–∞–∫ —Ä–∞–∑—Ä–µ—à–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ**, –Ω–µ –ª–æ–º–∞—è –æ—Å—Ç–∞–ª—å–Ω—É—é –∑–∞—â–∏—Ç—É —Å–∏—Å—Ç–µ–º—ã.

–¶–µ–ª—å:

–†–∞–∑—Ä–µ—à–∏—Ç—å —Å–µ—Ä–≤–∏—Å—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `pgchintegration.service`) –∑–∞–ø—É—Å–∫ Python-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –≤ `/home/admin/systemd/integration/pgchintegration/bin/python`, **–±–µ–∑ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è SELinux**, –Ω–æ –∏ **–±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–ª–Ω–æ–º–æ—á–∏–π**.

---

## ‚úÖ –ü–ª–∞–Ω:

1. –°–æ–±–µ—Ä—ë–º `.te`-—Ñ–∞–π–ª ‚Äî —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏.
2. –°–∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º –µ—ë –≤ `.pp`.
3. –£—Å—Ç–∞–Ω–æ–≤–∏–º –µ—ë —á–µ—Ä–µ–∑ `semodule`.

---

## üõ† –ü—Ä–∏–º–µ—Ä .te-—Ñ–∞–π–ª–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `pgchintegration.te`:

```bash
nano pgchintegration.te
```

–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ:

```te
module pgchintegration 1.0;

require {
    type unconfined_t;
    type user_home_t;
    class file { execute open read };
}

# –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ python –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ home
allow unconfined_t user_home_t:file { execute open read };
```

> üí° –ó–¥–µ—Å—å:
>
> * `unconfined_t` ‚Äî —ç—Ç–æ —Ç–∏–ø, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º —á–∞—â–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç `systemd` –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.
> * `user_home_t` ‚Äî —Ç–∏–ø —Ñ–∞–π–ª–æ–≤ –≤ `/home/...`, –Ω–∞–∑–Ω–∞—á–∞–µ–º—ã–π SELinux –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

## ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –°–∫–æ–º–ø–∏–ª–∏—Ä—É–π –º–æ–¥—É–ª—å:

```bash
checkmodule -M -m -o pgchintegration.mod pgchintegration.te
```

2. –£–ø–∞–∫—É–π –µ–≥–æ –≤ –º–æ–¥—É–ª—å:

```bash
semodule_package -o pgchintegration.pp -m pgchintegration.mod
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏:

```bash
sudo semodule -i pgchintegration.pp
```

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞

* –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:

```bash
semodule -l | grep pgchintegration
```

* –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å:

```bash
sudo systemctl restart pgchintegration.service
```


* –£–±–µ–¥–∏—Å—å, —á—Ç–æ –æ—à–∏–±–æ–∫ SELinux –Ω–µ—Ç:

```bash
sudo ausearch -m avc -ts recent
```

---

## üß† –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω—É–∂–Ω—ã–µ `type` –∏ `class`?

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —Å–æ–∑–¥–∞—Ç—å –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—É—Å–∫ **—Ç–æ–ª—å–∫–æ —ç—Ç–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞**, —Ç–æ–ª—å–∫–æ —ç—Ç–æ–º—É —Å–µ—Ä–≤–∏—Å—É), –∏—Å–ø–æ–ª—å–∑—É–π:

```bash
ls -Z /home/admin/systemd/integration/pgchintegration/bin/python
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
-rwxr-xr-x. admin admin unconfined_u:object_r:user_home_t:s0 python
```

–ó–¥–µ—Å—å:

* `user_home_t` ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –Ω—É–∂–Ω—ã–π `type`
* –ï—Å–ª–∏ –±—É–¥–µ—Ç `admin_home_t`, —Ç–æ –µ–≥–æ —É–∫–∞–∂–µ—à—å –≤ `.te`

---

## üöÄ –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (—Ç–æ—á–µ—á–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞)

–•–æ—á–µ—à—å –∂—ë—Å—Ç–∫—É—é –ø–æ–ª–∏—Ç–∏–∫—É? –ù–∞–ø—Ä–∏–º–µ—Ä: —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—É—Å–∫ `python` —Ç–æ–ª—å–∫–æ **—ç—Ç–æ–º—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É systemd-—Å–µ—Ä–≤–∏—Å—É**?

1. –°–Ω–∞—á–∞–ª–∞ –≤—ã—è—Å–Ω–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç:

```bash
ps -eZ | grep pgchintegration
```

–∏–ª–∏

```bash
sudo systemctl show pgchintegration.service --property=ExecContext
```

2. –ù–∞–ø–∏—à–∏ `.te`, –≥–¥–µ `allow YOUR_SERVICE_CONTEXT` ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å `systemd_service_t`, `init_t` –∏–ª–∏ –¥–∞–∂–µ –∫–∞—Å—Ç–æ–º–Ω—ã–π, –µ—Å–ª–∏ —Å–∞–º –Ω–∞–∑–Ω–∞—á–∏—à—å —á–µ—Ä–µ–∑ `semanage`.

---


–û—Ç–ª–∏—á–Ω–æ, —Ç—ã –¥–∞–ª –∏–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ ‚Äî —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ **—Ç–æ—á–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å SELinux –∑–∞–ø—É—Å–∫ `python` –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `/home/admin/...` –¥–ª—è —Ç–≤–æ–µ–≥–æ systemd-—Å–µ—Ä–≤–∏—Å–∞.**

---

## üìä –†–∞–∑–±–æ—Ä:

### üîπ –ö–æ–Ω—Ç–µ–∫—Å—Ç Python-–ø—Ä–æ—Ü–µ—Å—Å–∞:

```
system_u:system_r:pcp_pmcd_t:s0
```

–≠—Ç–æ `pcp_pmcd_t` ‚Äî –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ Performance Co-Pilot, **–Ω–µ –∫ —Ç–≤–æ–µ–º—É —Å–µ—Ä–≤–∏—Å—É.**

> –ù–∞–º –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Python **–æ—Ç systemd**, –ø–æ–¥ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º `system_u:system_r:init_t:s0` –∏–ª–∏ `systemd_t`, –µ—Å–ª–∏ —Ç–≤–æ–π —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `systemctl`.

---

### üîπ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ñ–∞–π–ª–æ–≤:

```
unconfined_u:object_r:user_home_t:s0
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —Ç–≤–æ–π `python`, `simple_etl.py` –∏ `pgchintegration` –ª–µ–∂–∞—Ç –≤ **–¥–æ–º–∞—à–Ω–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ**, —Å —Ç–∏–ø–æ–º `user_home_t`, –∫–æ—Ç–æ—Ä—ã–π **–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–ø—Ä–µ—â—ë–Ω –∫ –∑–∞–ø—É—Å–∫—É –æ—Ç systemd**.

---

## ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ–º: —Å–æ–∑–¥–∞—ë–º SELinux-–º–æ–¥—É–ª—å, —Ä–∞–∑—Ä–µ—à–∞—é—â–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å —Ç–∏–ø–æ–º `user_home_t` –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ —Å —Ç–∏–ø–æ–º `init_t` (—Ç–∏–ø–∏—á–Ω—ã–π systemd).

---

## üõ† –®–∞–≥ 1: –°–æ–∑–¥–∞–π `.te`-—Ñ–∞–π–ª

```bash
nano allow_pgchintegration.te
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```te
module allow_pgchintegration 1.0;

require {
    type user_home_t;
    type init_t;
    class file { read open execute execute_no_trans };
}

# –†–∞–∑—Ä–µ—à–∏—Ç—å systemd (init_t) –≤—ã–ø–æ–ª–Ω—è—Ç—å python –∏ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å —Ç–∏–ø–æ–º user_home_t
allow init_t user_home_t:file { read open execute execute_no_trans };
```

---

## üõ† –®–∞–≥ 2: –°–æ–±–µ—Ä–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏ –º–æ–¥—É–ª—å

```bash
checkmodule -M -m -o allow_pgchintegration.mod allow_pgchintegration.te
semodule_package -o allow_pgchintegration.pp -m allow_pgchintegration.mod
sudo semodule -i allow_pgchintegration.pp
```

---

## ‚úÖ –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å –∏ –ø—Ä–æ–≤–µ—Ä—å

```bash
sudo systemctl restart pgchintegration.service
sudo systemctl status pgchintegration.service
sudo ausearch -m avc -ts recent
```

–ï—Å–ª–∏ –≤—Å—ë —Å–¥–µ–ª–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî **–æ—à–∏–±–æ–∫ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç**, –∞ SELinux –±—É–¥–µ—Ç —Å–ø–æ–∫–æ–π–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –∏–∑ —Ç–≤–æ–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

---

## üìã –ü–æ—è—Å–Ω–µ–Ω–∏–µ –ø–æ `execute_no_trans`

* `execute` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ–∞–π–ª.
* `execute_no_trans` ‚Äî –∑–∞–ø—Ä–µ—â–∞–µ—Ç SELinux **–ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤ –¥—Ä—É–≥–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**, —Ç.–µ. –æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥ —Ç–µ–º –∂–µ, —á—Ç–æ –∏ –±—ã–ª (–≤–∞–∂–Ω–æ –¥–ª—è systemd).

---

–ú–æ–∂–Ω–æ **–µ—â—ë —É–∂–µ—Å—Ç–æ—á–∏—Ç—å**: —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª –∏–ª–∏ —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —é–∑–µ—Ä—É.

---

## ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å –ø—Ä–æ–µ–∫—Ç–∞ –≤ `/opt/`

–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏ "–ø–æ-–∞–¥–º–∏–Ω—Å–∫–∏" —á–∏—Å—Ç—ã–π –ø—É—Ç—å –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ SELinux, systemd –∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π.

–ü–æ—á–µ–º—É `/opt/` ‚Äî –ª—É—á—à–µ:

* SELinux **—Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ** –∏–∑ `/opt` (—Ç–∏–ø—ã –≤—Ä–æ–¥–µ `usr_t` –∏–ª–∏ `bin_t`)
* Systemd **–±–µ–∑ –ø—Ä–æ–±–ª–µ–º** –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã –∏–∑ `/opt`
* `/opt/` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –¥–æ–º–∞—à–Ω–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞

---

## üõ† –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:

1. üìÅ –ü–µ—Ä–µ–Ω–æ—Å –ø—Ä–æ–µ–∫—Ç–∞ –≤ `/opt/`
2. üêç –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π –∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º—É –æ–∫—Ä—É–∂–µ–Ω–∏—é
3. üßæ –ü—Ä–∞–≤–∫–∞ `etl.service`
4. üöÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ systemd –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

---

### üìÅ 1. –ü–µ—Ä–µ–Ω–µ—Å–∏ –ø—Ä–æ–µ–∫—Ç

```bash
sudo mkdir -p /opt/pgchintegration
sudo cp -r /home/admin/systemd/integration/* /opt/pgchintegration/
sudo chown -R admin:admin /opt/pgchintegration
```

üí° –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–∫–∞—è:

```
/opt/pgchintegration/
‚îú‚îÄ‚îÄ simple_etl.py
‚îú‚îÄ‚îÄ pgchintegration/       <-- venv
‚îÇ   ‚îî‚îÄ‚îÄ bin/python
‚îú‚îÄ‚îÄ run_pgchintegration.sh (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å)
```

---

### üêç 2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ `venv` —Ä–∞–±–æ—á–∏–π

```bash
cd /opt/pgchintegration
source pgchintegration/bin/activate
python simple_etl.py  # –ü—Ä–æ–≤–µ—Ä—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –≤—Ä—É—á–Ω—É—é
deactivate
```

---

### üßæ 3. –û–±–Ω–æ–≤–∏ `pgchintegration.service`

–û—Ç–∫—Ä–æ–π:

```bash
sudo nano /etc/systemd/system/pgchintegration.service
```

–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```ini
[Unit]
Description=ETL Background Service from /opt
After=network.target

[Service]
Type=simple
User=admin
WorkingDirectory=/opt/pgchintegration
ExecStart=/opt/pgchintegration/pgchintegration/bin/python simple_etl.py
Restart=always
RestartSec=5
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

---

### üîÑ 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å

```bash
sudo systemctl daemon-reload
sudo systemctl restart pgchintegration.service
sudo systemctl status pgchintegration.service
```

---

### üìã 5. –ü—Ä–æ–≤–µ—Ä–∫–∞

* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞:

  ```bash
  journalctl -u pgchintegration.service -f
  ```

* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SELinux:

  ```bash
  getenforce         # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å Enforcing
  sudo ausearch -m avc -ts recent
  ```

**–ï—Å–ª–∏ –≤—Å—ë –º–æ–ª—á–∏—Ç ‚Äî –∑–Ω–∞—á–∏—Ç SELinux –¥–æ–≤–æ–ª–µ–Ω** –∏ `python` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞.

---

### üß† –°–æ–≤–µ—Ç

–ú–æ–∂–µ—à—å —Å–æ–∑–¥–∞—Ç—å `/opt/pgchintegration/venv` –∏ —Ç–∞–º –¥–µ—Ä–∂–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –∞ –∫–æ–¥ –≤ `/opt/pgchintegration/app` ‚Äî –Ω–æ —ç—Ç–æ —É–∂–µ –Ω–∞ –≤–∫—É—Å –∏ —Å—Ç–∏–ª—å.

---

## —ç–ì–æ—Ç–æ–≤—ã–π bash-—Å–∫—Ä–∏–ø—Ç**

–ö–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç:

1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ `/opt/pgchintegration`
2. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ `~/systemd/integration/`
3. –ù–∞—Å—Ç—Ä–æ–π–∫—É –ø—Ä–∞–≤
4. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è `venv`
5. –£—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
6. –°–æ–∑–¥–∞–Ω–∏–µ `systemd`-—é–Ω–∏—Ç–∞
7. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ systemd –∏ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

---

## üìÑ –°–∫—Ä–∏–ø—Ç: `setup_pgchintegration.sh`

–°–æ—Ö—Ä–∞–Ω–∏ –µ–≥–æ –∫–∞–∫ `setup_pgchintegration.sh`, —Å–¥–µ–ª–∞–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º –∏ –∑–∞–ø—É—Å—Ç–∏ –æ—Ç `sudo`.

```bash
#!/bin/bash

set -e

APP_NAME="pgchintegration"
APP_USER="admin"
APP_DIR="/opt/$APP_NAME"
SRC_DIR="/home/$APP_USER/systemd/integration"
VENV_DIR="$APP_DIR/venv"
SERVICE_FILE="/etc/systemd/system/$APP_NAME.service"
PYTHON_BIN="/usr/bin/python3"

echo "üìÅ –°–æ–∑–¥–∞—ë–º –∫–∞—Ç–∞–ª–æ–≥ $APP_DIR..."
mkdir -p "$APP_DIR"
cp -r "$SRC_DIR/"* "$APP_DIR/"
chown -R "$APP_USER:$APP_USER" "$APP_DIR"

echo "üêç –°–æ–∑–¥–∞—ë–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ $VENV_DIR..."
$PYTHON_BIN -m venv "$VENV_DIR"

echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å requirements.txt)..."
if [[ -f "$APP_DIR/requirements.txt" ]]; then
    "$VENV_DIR/bin/pip" install --upgrade pip
    "$VENV_DIR/bin/pip" install -r "$APP_DIR/requirements.txt"
fi

echo "üßæ –°–æ–∑–¥–∞—ë–º systemd unit: $SERVICE_FILE"
cat <<EOF > "$SERVICE_FILE"
[Unit]
Description=ETL Background Service from /opt
After=network.target

[Service]
Type=simple
User=$APP_USER
WorkingDirectory=$APP_DIR
ExecStart=$VENV_DIR/bin/python simple_etl.py
Restart=always
RestartSec=5
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF

echo "üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º systemd –∏ –≤–∫–ª—é—á–∞–µ–º —Å–µ—Ä–≤–∏—Å..."
systemctl daemon-reload
systemctl enable "$APP_NAME.service"
systemctl restart "$APP_NAME.service"

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –°–µ—Ä–≤–∏—Å $APP_NAME –∑–∞–ø—É—â–µ–Ω."
systemctl status "$APP_NAME.service" --no-pager
```

---

## üõ† –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. –°–∫–æ–ø–∏—Ä—É–π —Å–∫—Ä–∏–ø—Ç:

```bash
nano setup_pgchintegration.sh
```

2. –í—Å—Ç–∞–≤—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, —Å–æ—Ö—Ä–∞–Ω–∏ –∏ —Å–¥–µ–ª–∞–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
chmod +x setup_pgchintegration.sh
```

3. –ó–∞–ø—É—Å—Ç–∏:

```bash
sudo ./setup_pgchintegration.sh
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

* –ö–æ–¥ –∏ `venv` –ª–µ–∂–∞—Ç –≤ `/opt/pgchintegration/`
* –°–µ—Ä–≤–∏—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `pgchintegration.service`
* –õ–æ–≥ –º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑:

```bash
journalctl -u pgchintegration.service -f
```

---
